<html>
	<head>
		<title>AoITHS ~ Housekeeping</title>
		<link rel="shortcut icon" href="http://cdn.mysitemyway.com/etc-mysitemyway/icons/legacy-previews/icons/glossy-black-3d-buttons-icons-alphanumeric/070542-glossy-black-3d-button-icon-alphanumeric-letter-aa.png">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/vader/jquery-ui.css" />
    <style>
			h1.page-header {
			    margin-top: -5px;
			}

			.sidebar {
			    padding-left: 0;
			}

			.main-container {
			    background: #FFF;
			    padding-top: 15px;
			    margin-top: -20px;
			}

			.footer {
			    width: 100%%;
			}
      #drop {
    font-weight: bold;
    text-align: center;
    padding: 1em 0;
    margin: 1em 0;
    color: #555;
    border: 2px dashed #555;
    border-radius: 7px;
    cursor: default;
}
		</style>

		<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	</head>

	<nav class="navbar navbar-default navbar-static-top">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">
					Academy of Innovative Technology
				</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="http://aoiths.org" target="_blank">Visit Site</a></li>
					<li class="dropdown ">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
							Account
							<span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li class="dropdown-header">SETTINGS</li>
								<li class=""><a href="#">Other Link</a></li>
								<li class=""><a href="#">Other Link</a></li>
								<li class=""><a href="#">Other Link</a></li>
								<li class="divider"></li>
								<li><a href="#">Logout</a></li>
							</ul>
						</li>
					</ul>
				</div><!-- /.navbar-collapse -->
			</div><!-- /.container-fluid -->
		</nav>
		<div class="container-fluid main-container">
			<div class="col-md-2 sidebar">
				<ul class="nav nav-pills nav-stacked">
					<li><a href="/adm/dashboard">Home</a></li>
					<li class="active"><a href="/adm/dashboard/photos">Add Photo</a></li>
					<li><a href="/adm/dashboard/events">Add Event</a></li>
					<li><a href="/adm/dashboard/announcements">Add Announcement</a></li>
					<li><a href="#">Add Blog</a></li>
					<li><a href="#">Check Mail</a></li>
				</ul>
			</div>
			<div class="col-md-10 content">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Add Photos
	                </div>
	                <div class="panel-body">
                    <div class="alert alert-danger">
                      Only %s images are saved.
                    </div>
                    <fieldset style="border: 1px black solid; border-radius: 6px; padding:10px;">
                      <p id="status">Select an image</p>
                      <div id="progressbar"></div>
                      <input id="file" type="file" />
                      <br>
                      <div id="drop">or drop image here</div>
                    </fieldset>
                    <br>
                    <br>
                    <div style="border: 1px black solid; border-radius: 6px; padding: 50px;">
                      <h3>Uploaded Images</h3>
                      <div id="images">%s</div>
                    </div>
                    <script>
                      function sse() {
                          var source = new EventSource('/stream');
                          source.onmessage = function(e) {
                              if (e.data == '')
                                  return;
                              var data = $.parseJSON(e.data);
                              var upload_message = 'Image uploaded by ' + data['ip_addr'];
                              var image = $('<img>', {alt: upload_message, src: data['src']});
                              var container = $('<div>').hide();
                              container.append($('<div>', {text: upload_message}));
                              container.append(image);
                              $('#images').prepend(container);
                              image.load(function(){
                                  container.show('blind', {}, 1000);
                              });
                          };
                      }
                      function file_select_handler(to_upload) {
                          var progressbar = $('#progressbar');
                          var status = $('#status');
                          var xhr = new XMLHttpRequest();
                          xhr.upload.addEventListener('loadstart', function(e1){
                              status.text('uploading image');
                              progressbar.progressbar({max: e1.total});
                          });
                          xhr.upload.addEventListener('progress', function(e1){
                              if (progressbar.progressbar('option', 'max') == 0)
                                  progressbar.progressbar('option', 'max', e1.total);
                              progressbar.progressbar('value', e1.loaded);
                          });
                          xhr.onreadystatechange = function(e1) {
                              if (this.readyState == 4)  {
                                  if (this.status == 200)
                                      var text = 'upload complete: ' + this.responseText;
                                  else
                                      var text = 'upload failed: code ' + this.status;
                                  status.html(text + '<br/>Select an image');
                                  progressbar.progressbar('destroy');
                              }
                          };
                          xhr.open('POST', '/post', true);
                          xhr.send(to_upload);
                      };
                      function handle_hover(e) {
                          e.originalEvent.stopPropagation();
                          e.originalEvent.preventDefault();
                          e.target.className = (e.type == 'dragleave' || e.type == 'drop') ? '' : 'hover';
                      }
                      $('#drop').bind('drop', function(e) {
                          handle_hover(e);
                          if (e.originalEvent.dataTransfer.files.length < 1) {
                              return;
                          }
                          file_select_handler(e.originalEvent.dataTransfer.files[0]);
                      }).bind('dragenter dragleave dragover', handle_hover);
                      $('#file').change(function(e){
                          file_select_handler(e.target.files[0]);
                          e.target.value = '';
                      });
                      sse();
                    </script>
	                </div>
	            </div>
			</div>

			<footer class="pull-left footer">
				<p class="col-md-12">
					<hr class="divider">
					&copy; <a href="http://aoiths.org">Academy of Innovative Technology</a>
				</p>
			</footer>
		</div>
<html>
